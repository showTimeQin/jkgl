$(function(){var registerForm=$("#form-register");var token=$(":input[name='authenticity_token']",registerForm).val()||"";var fields=$(":input[data-path]",registerForm);var inputs=$(":input",registerForm);var msgBox=$("#msg");$('[data-toggle="popover"]',registerForm).popover();registerForm.on("submit",function(evt){var serializeArray=$(this).serializeArray();var postData=_.boohee.toPostData(serializeArray);$.ajax(this.action,{type:'POST',dataType:'json',data:postData,complete:function(argument){},success:function(data){if(data.status==200){msgBox.html("");msgBox.slideUp("fast");location.href=data.redirect_url||"/profile/register_success";}else{msgBox.html(data.message);msgBox.slideDown("fast");}},error:function(msg){msgBox.html("出错了");msgBox.slideDown("fast");}});return false;});fields.on("change",function(evt){var field=$(this);var validPath=field.attr("data-path");var validRule=field.attr("data-rule")||"\\S+";var fieldID=this.id;var fieldValue=field.val();var pattern=new RegExp(validRule);var postData={};var isValid=pattern.test(fieldValue);postData['authenticity_token']=token;postData[fieldID]=field.val();$.ajax(validPath,{type:'POST',dataType:'json',data:postData,success:function(data){if(data.status==200){field.removeClass("warning");field.addClass("success");msgBox.html("");msgBox.slideUp("fast");}else{field.addClass("warning");field.removeClass("success");msgBox.html(data.message);msgBox.slideDown("fast");}},error:function(msg){}});});});$(function(){var loginForm=$("#form-login");var token=$(":input[name='authenticity_token']",loginForm).val()||"";var fields=$(":input[data-path]",loginForm);var inputs=$(":input",loginForm);var userName=$("#user_name");var msgBox=$("#msg");var res=window._BH_RESPONSE;if(res&&res.message){switch(res.status){case 200:{}
default:{msgBox.html(res.message);msgBox.slideDown("fast");if(res.error_type==100){userName.focus();}
break;}}}});